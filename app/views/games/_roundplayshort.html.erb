<div id="playrounds">

    <div class="playarea" id="r1play">
      <div class="roundtitle">Round 1 of 4</div>
      Category: <span class="gamecategories"><%= @game.r1cat %></span>
      <div class="gameletters" id="round1letters"><%= @game.r1letters %></div>
      <div>
        <%= form_for @gamedata, :url => updateanswer_gamedata_path, :html => {:method => :post, :id => "r1answerform"}, remote: true do |f| %>
          <div>
            <%= f.hidden_field :game_id, :value => @game.id %>
            <span><%= f.text_field :r1answer, :class => "answerfield", :id => "r1answerfield", :placeholder => "Enter or change Round 1 acro here...", :autofocus => true %></span>
            <span id="r1answer"><%= f.submit "Play", :class => "button answersubmitbutton" %>
            </span>
          </div>
        <% end %>
      </div>
      <div id="r1answered">
        <% if @currentgamedata.r1answer == nil %>
          Your acro: No acro yet...
        <% else %>
          Your acro: "<%= @currentgamedata.r1answer %>"
        <% end %>
      </div>
      <% if @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer %>
        <div class="allanswered">
          You've completed every acro! Voting round coming up.
          <% if @gamedata.voteemailsent == false %>
            Send email to <%= current_user.email %> when voting round starts? <span style="font-size: 84%;">(change in settings if email address is incorrect) </span>
            <%= button_to "Send reminder email", {:controller => "games", :action => "sendemail", :method => "put", :game_id => @game.id}, :class => "button voteemailsend", remote: true %>
          <% else %>
            (vote reminder email has been scheduled)
          <% end %>
        </div>
      <% else %>
        <div class="allanswered hidden">
          You've completed every acro! Voting round coming up.
          <% if @gamedata.voteemailsent == false %>
            Send email to <%= current_user.email %> when voting round starts? <span style="font-size: 84%;">(change in settings if email address is incorrect) </span>
            <%= button_to "Send reminder email", {:controller => "games", :action => "sendemail", :method => "put", :game_id => @game.id}, :class => "button voteemailsend", remote: true %>
          <% else %>
            (vote reminder email has been scheduled)
          <% end %>
        </div>
      <% end %>
      <div class="playroundbutton">
        <% if @gamedata.r1answer && @gamedata.r2answer == nil %>
          <%= button_tag "Round 1", :class => "r1playbutton roundplayanswered" %>
          <%= button_tag "Round 2", :class => "r2playbutton" %><br>
        <% elsif @gamedata.r1answer && @gamedata.r2answer %>
          <%= button_tag "Round 1", :class => "r1playbutton roundplayanswered" %>
          <%= button_tag "Round 2", :class => "r2playbutton roundplayanswered" %><br>
        <% else %>
          <%= button_tag "Round 1", :class => "r1playbutton" %>
          <%= button_tag "Round 2", :class => "r2playbutton roundplaylocked" %><br>
        <% end %>
        <div>
          <% if @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer == nil %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplayanswered" %>
            <%= button_tag "Round 4", :class => "r4playbutton" %><br>
          <% elsif @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplayanswered" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplayanswered" %><br>
          <% elsif @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer == nil %>
            <%= button_tag "Round 3", :class => "r3playbutton" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplaylocked" %><br>
          <% else %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplaylocked" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplaylocked" %><br>
          <% end %>
        </div>
      </div>
    </div>

    <div class="playarea" id="r2play">
      <div class="roundtitle">Round 2 of 4</div>
      Category: <span class="gamecategories"><%= @game.r2cat %></span>
      <div class="gameletters" id="round2letters"><%= @game.r2letters %></div>
      <div>
        <%= form_for @gamedata, :url => updateanswer_gamedata_path, :html => {:method => :post, :id => "r2answerform"}, remote: true do |g| %>
          <div>
            <%= g.hidden_field :game_id, :value => @game.id %>
            <span><%= g.text_field :r2answer, :class => "answerfield", :id => "r2answerfield", :placeholder => "Enter or change Round 2 acro here...", :autofocus => true %></span>
            <span id="r2answer"><%= g.submit "Play", :class => "button answersubmitbutton" %>
            </span>
          </div>
        <% end %>
      </div>
      <div id="r2answered">
        <% if @currentgamedata.r2answer == nil %>
          Your acro: No acro yet...
        <% else %>
          Your acro: "<%= @currentgamedata.r2answer %>"
        <% end %>
      </div>
      <% if @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer %>
        <div class="allanswered">
          You've completed every acro! Voting round coming up.
          <% if @gamedata.voteemailsent == false %>
            Send email to <%= current_user.email %> when voting round starts? <span style="font-size: 84%;">(change in settings if email address is incorrect) </span>
            <%= button_to "Send reminder email", {:controller => "games", :action => "sendemail", :method => "put", :game_id => @game.id}, :class => "button voteemailsend", remote: true %>
          <% else %>
            (vote reminder email has been scheduled)
          <% end %>
        </div>
      <% else %>
        <div class="allanswered hidden">
          You've completed every acro! Voting round coming up.
          <% if @gamedata.voteemailsent == false %>
            Send email to <%= current_user.email %> when voting round starts? <span style="font-size: 84%;">(change in settings if email address is incorrect) </span>
            <%= button_to "Send reminder email", {:controller => "games", :action => "sendemail", :method => "put", :game_id => @game.id}, :class => "button voteemailsend", remote: true %>
          <% else %>
            (vote reminder email has been scheduled)
          <% end %>
        </div>
      <% end %>
      <div class="playroundbutton">
        <% if @gamedata.r1answer && @gamedata.r2answer == nil %>
          <%= button_tag "Round 1", :class => "r1playbutton roundplayanswered" %>
          <%= button_tag "Round 2", :class => "r2playbutton" %><br>
        <% elsif @gamedata.r1answer && @gamedata.r2answer %>
          <%= button_tag "Round 1", :class => "r1playbutton roundplayanswered" %>
          <%= button_tag "Round 2", :class => "r2playbutton roundplayanswered" %><br>
        <% else %>
          <%= button_tag "Round 1", :class => "r1playbutton" %>
          <%= button_tag "Round 2", :class => "r2playbutton roundplaylocked" %><br>
        <% end %>
        <div>
          <% if @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer == nil %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplayanswered" %>
            <%= button_tag "Round 4", :class => "r4playbutton" %><br>
          <% elsif @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplayanswered" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplayanswered" %><br>
          <% elsif @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer == nil %>
            <%= button_tag "Round 3", :class => "r3playbutton" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplaylocked" %><br>
          <% else %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplaylocked" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplaylocked" %><br>
          <% end %>
        </div>
      </div>
    </div>

    <div class="playarea" id="r3play">
      <div class="roundtitle">Round 3 of 4</div>
      Category: <span class="gamecategories"><%= @game.r3cat %></span>
      <div class="gameletters" id="round3letters"><%= @game.r3letters %></div>
      <div>
        <%= form_for @gamedata, :url => updateanswer_gamedata_path, :html => {:method => :post, :id => "r3answerform"}, remote: true do |h| %>
          <div>
            <%= h.hidden_field :game_id, :value => @game.id %>
            <span><%= h.text_field :r3answer, :class => "answerfield", :id => "r3answerfield", :placeholder => "Enter or change Round 3 acro here...", :autofocus => true %></span>
            <span id="r3answer"><%= h.submit "Play", :class => "button answersubmitbutton" %>
            </span>
          </div>
        <% end %>
      </div>
      <div id="r3answered">
        <% if @currentgamedata.r3answer == nil %>
          Your acro: No acro yet...
        <% else %>
          Your acro: "<%= @currentgamedata.r3answer %>"
        <% end %>
      </div>
      <% if @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer %>
        <div class="allanswered">
          You've completed every acro! Voting round coming up.
          <% if @gamedata.voteemailsent == false %>
            Send email to <%= current_user.email %> when voting round starts? <span style="font-size: 84%;">(change in settings if email address is incorrect) </span>
            <%= button_to "Send reminder email", {:controller => "games", :action => "sendemail", :method => "put", :game_id => @game.id}, :class => "button voteemailsend", remote: true %>
          <% else %>
            (vote reminder email has been scheduled)
          <% end %>
        </div>
      <% else %>
        <div class="allanswered hidden">
          You've completed every acro! Voting round coming up.
          <% if @gamedata.voteemailsent == false %>
            Send email to <%= current_user.email %> when voting round starts? <span style="font-size: 84%;">(change in settings if email address is incorrect) </span>
            <%= button_to "Send reminder email", {:controller => "games", :action => "sendemail", :method => "put", :game_id => @game.id}, :class => "button voteemailsend", remote: true %>
          <% else %>
            (vote reminder email has been scheduled)
          <% end %>
        </div>
      <% end %>
      <div class="playroundbutton">
        <% if @gamedata.r1answer && @gamedata.r2answer == nil %>
          <%= button_tag "Round 1", :class => "r1playbutton roundplayanswered" %>
          <%= button_tag "Round 2", :class => "r2playbutton" %><br>
        <% elsif @gamedata.r1answer && @gamedata.r2answer %>
          <%= button_tag "Round 1", :class => "r1playbutton roundplayanswered" %>
          <%= button_tag "Round 2", :class => "r2playbutton roundplayanswered" %><br>
        <% else %>
          <%= button_tag "Round 1", :class => "r1playbutton" %>
          <%= button_tag "Round 2", :class => "r2playbutton roundplaylocked" %><br>
        <% end %>
        <div>
          <% if @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer == nil %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplayanswered" %>
            <%= button_tag "Round 4", :class => "r4playbutton" %><br>
          <% elsif @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplayanswered" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplayanswered" %><br>
          <% elsif @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer == nil %>
            <%= button_tag "Round 3", :class => "r3playbutton" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplaylocked" %><br>
          <% else %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplaylocked" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplaylocked" %><br>
          <% end %>
        </div>
      </div>
    </div>

    <div class="playarea" id="r4play">
      <div class="roundtitle">Round 4 of 4</div>
      Category: <span class="gamecategories"><%= @game.r4cat %></span>
      <div class="gameletters" id="round4letters"><%= @game.r4letters %></div>
      <div>
        <%= form_for @gamedata, :url => updateanswer_gamedata_path, :html => {:method => :post, :id => "r4answerformshortgame"}, remote: true do |i| %>
          <div>
            <%= i.hidden_field :game_id, :value => @game.id %>
            <span><%= i.text_field :r4answer, :class => "answerfield", :id => "r4answerfield", :placeholder => "Enter or change Round 4 acro here...", :autofocus => true %></span>
            <span id="r4answer"><%= i.submit "Play", :class => "button answersubmitbutton" %>
            </span>
          </div>
        <% end %>
      </div>
      <div id="r4answeredshortgame">
        <% if @currentgamedata.r4answer == nil %>
          Your acro: No acro yet...
        <% else %>
          Your acro: "<%= @currentgamedata.r4answer %>"
        <% end %>
      </div>
      <% if @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer %>
        <div class="allanswered">
          You've completed every acro! Voting round coming up.
          <% if @gamedata.voteemailsent == false %>
            Send email to <%= current_user.email %> when voting round starts? <span style="font-size: 84%;">(change in settings if email address is incorrect) </span>
            <%= button_to "Send reminder email", {:controller => "games", :action => "sendemail", :method => "put", :game_id => @game.id}, :class => "button voteemailsend", remote: true %>
          <% else %>
            (vote reminder email has been scheduled)
          <% end %>
        </div>
      <% else %>
        <div class="allanswered hidden">
          You've completed every acro! Voting round coming up.
          <% if @gamedata.voteemailsent == false %>
            Send email to <%= current_user.email %> when voting round starts? <span style="font-size: 84%;">(change in settings if email address is incorrect) </span>
            <%= button_to "Send reminder email", {:controller => "games", :action => "sendemail", :method => "put", :game_id => @game.id}, :class => "button voteemailsend", remote: true %>
          <% else %>
            (vote reminder email has been scheduled)
          <% end %>
        </div>
      <% end %>
      <div class="playroundbutton">
        <% if @gamedata.r1answer && @gamedata.r2answer == nil %>
          <%= button_tag "Round 1", :class => "r1playbutton roundplayanswered" %>
          <%= button_tag "Round 2", :class => "r2playbutton" %><br>
        <% elsif @gamedata.r1answer && @gamedata.r2answer %>
          <%= button_tag "Round 1", :class => "r1playbutton roundplayanswered" %>
          <%= button_tag "Round 2", :class => "r2playbutton roundplayanswered" %><br>
        <% else %>
          <%= button_tag "Round 1", :class => "r1playbutton" %>
          <%= button_tag "Round 2", :class => "r2playbutton roundplaylocked" %><br>
        <% end %>
        <div>
          <% if @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer == nil %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplayanswered" %>
            <%= button_tag "Round 4", :class => "r4playbutton" %><br>
          <% elsif @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer && @gamedata.r4answer %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplayanswered" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplayanswered" %><br>
          <% elsif @gamedata.r1answer && @gamedata.r2answer && @gamedata.r3answer == nil %>
            <%= button_tag "Round 3", :class => "r3playbutton" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplaylocked" %><br>
          <% else %>
            <%= button_tag "Round 3", :class => "r3playbutton roundplaylocked" %>
            <%= button_tag "Round 4", :class => "r4playbutton roundplaylocked" %><br>
          <% end %>
        </div>
      </div>
    </div>

    <% if current_user.tooltips == true %>
      <fieldset class="tooltips">
        <legend style="text-align: left; margin-left: 6px;">Tip</legend>
          To play, create a phrase based on the letters given and the topic. For example, given the letters "EMTT" and the category "Food", you might write "Eat more tacos today." Be sure to give an answer for every round. Then, later return to vote on your favorite answers from other players!<br><br>
          "<%= @game.name %>" is the name of this game room. You will find it listed on the home page.
        <%= button_to "Turn tips off", {:controller => "pages", :action => "tipsoff", :method => "put"}, :class => "button", remote: true %>
      </fieldset>
      <script>
        $(".button.tipbutton").click(function() {
          $(".tooltips").hide();
        });
      </script>
    <% end %>

    <div class="chatbutton">
      <% if Gamedata.where(:game_id => @game.id).where(:user_id => current_user.id).first.whochatted != "" %>
        <%= link_to(gamechat_games_path(@game)) do %>
          <div class="gamechat button">
            <span class="chatlinknotify"><%= Gamedata.where(:game_id => @game.id).where(:user_id => current_user.id).first.whochatted + ' has chatted!' %> <%= image_tag("emoji/speech_balloon.png", :class => "smallspeechimage") %></span><br>
          </div>
        <% end %>
      <% else %>
        <%= link_to(gamechat_games_path(@game)) do %>
          <div class="gamechat button">
            <span class="chatlink">Game chat</span><br>
          </div>
        <% end %>
      <% end %>
    </div>
    <span class="timeremaining">Time left to play: <%= @timeremaining %>.
      <% if @game.playendtime != nil %>
      <script>
        var timeleft = <%= (((@game.playendtime - DateTime.now.utc).round) * 1000) + 1500 %>
        function reloadPage() {
          document.location.reload(true);
        }
        setTimeout(reloadPage, timeleft);
      </script>
    <% end %>
    </span><br>
    # of players: <%= @game.playercount %> of 12:
    <% @players.each do |player| %>
      <%= User.where(:id => player).first.username %>
      <%= "," unless player == @players.last %>
    <% end %>

  </div>
